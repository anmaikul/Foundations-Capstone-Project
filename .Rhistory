str(result)
summary(reuslt)
summary(result)
Label %in% names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)]
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column))
?gather
gather(c1045.as.column, key = "Label", value = "Activity", 4:ncol(c1045.as.column))
?mutate
dim(result)
names(result)
names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)]
names(c1045.as.column)
testt <- data.frame(c(0,1))
as.logical(testt)
?as.logical
?transform
paradigm <- transform(paradigm, Biological = as.logical(Biological), Random = as.logical(Random))
paradigm
#gather all time activitry points into one column, for all masked points.
#introduce group factors for biological vs motion, and activation region vs. not activated
result <- subset(c1045.as.column, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column)) %>%
mutate(on.off = Label %in% names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
###repeat the above, but using CENTERED fMRI data (mean centered at 0)
result <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column.centered)) %>%
mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
c1045.as.column.centered <- c1045.as.column
c1045.as.column.centered[,4:ncol(c1045.as.column.centered)] <-
sweep( c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1,
apply(c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1, mean),
"-"  )
###repeat the above, but using CENTERED fMRI data (mean centered at 0)
c1045.as.column.centered <- c1045.as.column
c1045.as.column.centered[,4:ncol(c1045.as.column.centered)] <-
sweep( c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1,
apply(c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1, mean),
"-"  )
result <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column.centered)) %>%
mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
head(c1045.as.column.centered)
head(c1045.as.column)
###repeat the above, but using CENTERED fMRI data (mean centered at 0)
c1045.as.column.centered <- c1045.as.column
c1045.as.column.centered[,4:ncol(c1045.as.column.centered)] <-
sweep( c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1,
apply(c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1, mean),
"-"  )
result <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column.centered)) %>%
mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
#plot histograms of time activity points for different task, over all voxels
p1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +
geom_histogram(aes(x=values))
p2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +
geom_histogram(aes(x=values))
p3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = ! (names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask")) )) +
geom_histogram(aes(x=values))
grid.arrange(p1,p2,p3,ncol=3)
###Looking at relationship between activity levels, between biological, random
##plot histogram of activity levels for different tasks, over ONLY active voxels
p1 <- ggplot(data=stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask > 0),
select = -c(1,2,3) )) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
temp <- stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask ==0 ),
select = -c(1,2,3) )
temp <- sample_frac(temp, size=.1, replace=FALSE)
p2 <- ggplot(data=temp) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
grid.arrange(p1,p2,ncol=2)
temp <- gather(subset(c1045.as.column.centered, subset = BrainMask != 0),
key = "TimePoint", value = "result", 4:ncol(c1045.as.column.centered))
temp <- sample_frac(temp, size=.1, replace=FALSE)
ggplot(data=temp) +
geom_boxplot(aes(x= ClusterMask == 0, y=result)) +
ylim(c(-100,100)) +
labs(x="Active Region", y="BOLD Signal Intensity")
##histogram of Z scores
#ggplot(data=sample) +
#  geom_histogram(aes(x=.5*log((1+ZStat)/(1-ZStat)))) +
#  labs(x="Fisher transform of Z Stat") +
#  facet_wrap(~on.off)
##boxplot of Z scores for on and off
#ggplot(data=sample) +
#  geom_boxplot(aes(x=on.off, y=ZStat))
c1045.as.column$corr.biological <- apply(subset(c1045.as.column,
select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")),
1, cor, paradigm$Biological)
temp <- sample_frac(subset(c1045.as.column, BrainMask != 0), size = .1, replace = FALSE)
ggplot(data = temp, aes(x=ZStat, y=.5*log((1+corr.biological)/(1-corr.biological)))) +
geom_point(aes(color=ClusterMask)) +
labs(y="Correlation Coefficient")
temp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")))
stats.activities.bio <- apply(temp[,paradigm$Biological], 1,
function(x) {
c(max = max(x),
median = median(x),
mean = mean(x),
quantile90 = quantile(x,probs=.9),
quantile80 = quantile(x,probs=.8),
quantile70 = quantile(x,probs=.7))
})
temp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")))
stats.activities.rand <- apply(temp[,paradigm$Random], 1,
function(x) {
c(max = max(x),
median = median(x),
mean = mean(x),
quantile90 = quantile(x,probs=.9),
quantile80 = quantile(x,probs=.8),
quantile70 = quantile(x,probs=.7))
})
temp <- data.frame(matrix(0, nrow = nrow(c1045.as.column), ncol = 6))
temp[c1045.as.column$BrainMask != 0,] <- t(stats.activities.bio - stats.activities.rand)
names(temp) <- c("bio.rand.max.min.diff", "bio.rand.median.diff",
"bio.rand.mean.diff", "bio.quantile90.diff",
"bio.quantile80.diff", "bio.quantile70.diff")
c1045.as.column <- cbind(c1045.as.column, temp)
rm(list = c(stats.activities.bio, stats.activities.rand))
p1 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.max.min.diff)) +
geom_point(aes(color=ClusterMask))
p2 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.median.diff)) +
geom_point(aes(color=ClusterMask))
p3 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.mean.diff)) +
geom_point(aes(color=ClusterMask))
grid.arrange(p1,p2,p3,ncol = 3)
p1<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile90.diff)) +
geom_point(aes(color=ClusterMask))
p2<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile80.diff)) +
geom_point(aes(color=ClusterMask))
p3<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile70.diff)) +
geom_point(aes(color=ClusterMask))
grid.arrange(p1, p2,p3,ncol = 3)
c1045.as.column$bio.rand.max.min.diff <- NULL
c1045.as.column$bio.rand.median.diff <- NULL
c1045.as.column$bio.rand.mean.diff <- NULL
c1045.as.column$bio.rand.quantile90.diff <- NULL
c1045.as.column$bio.rand.quantile80.diff <- NULL
c1045.as.column$bio.rand.quantile70.diff <- NULL
p1<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile90.diff)) +
geom_point(aes(color=ClusterMask))
p2<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile80.diff)) +
geom_point(aes(color=ClusterMask))
p3<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile70.diff)) +
geom_point(aes(color=ClusterMask))
grid.arrange(p1, p2,p3,ncol = 3)
save(list = c("c1045.as.column", "paradigm"), file = "4width_binned_data.RData")
?load
# Chunk 1: setup
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
source("/Volumes/UNTITLED/Foundations_Course/Capstone/exploratory_script_load.R")
# Chunk 2
load("4width_binned_data.RData")
# Chunk 3
#plot histograms of time activity points for different task, over all voxels
p1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +
geom_histogram(aes(x=values))
p2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +
geom_histogram(aes(x=values))
p3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = ! (names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask")) )) +
geom_histogram(aes(x=values))
grid.arrange(p1,p2,p3,ncol=3)
# Chunk 4
#plot histogram of time activity for different tasks, over ONLY active voxels
p1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0),
select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +
geom_histogram(aes(x=values))
p2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask >0 ),
select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +
geom_histogram(aes(x=values))
p3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0),
select = ! (names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask")) )) +
geom_histogram(aes(x=values))
grid.arrange(p1,p2,p3,ncol=3)
# Chunk 5
#gather all time activitry points into one column, for all masked points.
#introduce group factors for biological vs motion, and activation region vs. not activated
result <- subset(c1045.as.column, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column)) %>%
mutate(on.off = Label %in% names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
# Chunk 6
###repeat the above, but using CENTERED fMRI data (mean centered at 0)
c1045.as.column.centered <- c1045.as.column
c1045.as.column.centered[,4:ncol(c1045.as.column.centered)] <-
sweep( c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1,
apply(c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1, mean),
"-"  )
result <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column.centered)) %>%
mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
# Chunk 7
###Looking at relationship between activity levels, between biological, random
##plot histogram of activity levels for different tasks, over ONLY active voxels
p1 <- ggplot(data=stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask > 0),
select = -c(1,2,3) )) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
temp <- stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask ==0 ),
select = -c(1,2,3) )
temp <- sample_frac(temp, size=.1, replace=FALSE)
p2 <- ggplot(data=temp) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
grid.arrange(p1,p2,ncol=2)
temp <- gather(subset(c1045.as.column.centered, subset = BrainMask != 0),
key = "TimePoint", value = "result", 4:ncol(c1045.as.column.centered))
temp <- sample_frac(temp, size=.1, replace=FALSE)
ggplot(data=temp) +
geom_boxplot(aes(x= ClusterMask == 0, y=result)) +
ylim(c(-100,100)) +
labs(x="Active Region", y="BOLD Signal Intensity")
##histogram of Z scores
#ggplot(data=sample) +
#  geom_histogram(aes(x=.5*log((1+ZStat)/(1-ZStat)))) +
#  labs(x="Fisher transform of Z Stat") +
#  facet_wrap(~on.off)
##boxplot of Z scores for on and off
#ggplot(data=sample) +
#  geom_boxplot(aes(x=on.off, y=ZStat))
# Chunk 8
c1045.as.column$corr.biological <- apply(subset(c1045.as.column,
select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")),
1, cor, paradigm$Biological)
temp <- sample_frac(subset(c1045.as.column, BrainMask != 0), size = .1, replace = FALSE)
ggplot(data = temp, aes(x=ZStat, y=.5*log((1+corr.biological)/(1-corr.biological)))) +
geom_point(aes(color=ClusterMask)) +
labs(y="Fisher transform of Correlation Coefficient")
# Chunk 9
temp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")))
stats.activities.bio <- apply(temp[,paradigm$Biological], 1,
function(x) {
c(max = max(x),
median = median(x),
mean = mean(x),
quantile90 = quantile(x,probs=.9),
quantile80 = quantile(x,probs=.8),
quantile70 = quantile(x,probs=.7))
})
temp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")))
stats.activities.rand <- apply(temp[,paradigm$Random], 1,
function(x) {
c(max = max(x),
median = median(x),
mean = mean(x),
quantile90 = quantile(x,probs=.9),
quantile80 = quantile(x,probs=.8),
quantile70 = quantile(x,probs=.7))
})
temp <- data.frame(matrix(0, nrow = nrow(c1045.as.column), ncol = 6))
temp[c1045.as.column$BrainMask != 0,] <- t(stats.activities.bio - stats.activities.rand)
names(temp) <- c("bio.rand.max.min.diff", "bio.rand.median.diff",
"bio.rand.mean.diff", "bio.quantile90.diff",
"bio.quantile80.diff", "bio.quantile70.diff")
c1045.as.column <- cbind(c1045.as.column, temp)
rm(list = c(stats.activities.bio, stats.activities.rand))
p1 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.max.min.diff)) +
geom_point(aes(color=ClusterMask))
p2 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.median.diff)) +
geom_point(aes(color=ClusterMask))
p3 <- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.rand.mean.diff)) +
geom_point(aes(color=ClusterMask))
grid.arrange(p1,p2,p3,ncol = 3)
p1<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile90.diff)) +
geom_point(aes(color=ClusterMask))
p2<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile80.diff)) +
geom_point(aes(color=ClusterMask))
p3<- ggplot(data = subset(c1045.as.column, BrainMask != 0),
aes(x=ZStat, y=bio.quantile70.diff)) +
geom_point(aes(color=ClusterMask))
grid.arrange(p1, p2,p3,ncol = 3)
c1045.as.column$bio.rand.max.min.diff <- NULL
c1045.as.column$bio.rand.median.diff <- NULL
c1045.as.column$bio.rand.mean.diff <- NULL
c1045.as.column$bio.rand.quantile90.diff <- NULL
c1045.as.column$bio.rand.quantile80.diff <- NULL
c1045.as.column$bio.rand.quantile70.diff <- NULL
dim(paradigm)
dim(c1045.as.column)
paradigm
head(c1045.as.column)
c1045.as.column[,23:ncol(c1045.as.column)] <- list(NULL)
names(c1045.as.column)
dim(c1045.as.column)
dim(paradigm)
load("4width_binned_data.RData")
dim(c1045.as.column)
names(c1045.as.column)
c1045.as.column[,42:ncol(c1045.as.column)] <- list(NULL)
names(c1045.as.column)
save(list = c("c1045.as.column", "paradigm"), file = "4width_binned_data.RData")
# Chunk 1: setup
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
source("/Volumes/UNTITLED/Foundations_Course/Capstone/exploratory_script_load.R")
# Chunk 2
load("4width_binned_data.RData")
# Chunk 3
#plot histograms of time activity points for different task, over all voxels
p1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +
geom_histogram(aes(x=values))
p2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +
geom_histogram(aes(x=values))
p3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0),
select = ! (names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask")) )) +
geom_histogram(aes(x=values))
grid.arrange(p1,p2,p3,ncol=3)
# Chunk 4
#plot histogram of time activity for different tasks, over ONLY active voxels
p1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0),
select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +
geom_histogram(aes(x=values))
p2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask >0 ),
select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +
geom_histogram(aes(x=values))
p3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0),
select = ! (names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask")) )) +
geom_histogram(aes(x=values))
grid.arrange(p1,p2,p3,ncol=3)
# Chunk 5
#gather all time activitry points into one column, for all masked points.
#introduce group factors for biological vs motion, and activation region vs. not activated
result <- subset(c1045.as.column, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column)) %>%
mutate(on.off = Label %in% names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
# Chunk 6
###repeat the above, but using CENTERED fMRI data (mean centered at 0)
c1045.as.column.centered <- c1045.as.column
c1045.as.column.centered[,4:ncol(c1045.as.column.centered)] <-
sweep( c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1,
apply(c1045.as.column.centered[,4:ncol(c1045.as.column.centered)], 1, mean),
"-"  )
result <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%
gather(key = "Label", value = "Activity", 4:ncol(c1045.as.column.centered)) %>%
mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])
result$color.groups <- "None"
result$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- "1Biological, Not Active"
result$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- "2Random, Not Active"
result$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- "3Biological, Activated"
result$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- "4Random, Activated"
result$color.groups <- as.factor(result$color.groups)
#get just a small sample (1%) of the activity data, otherwise too many voxels
sampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)
#scatterplot of Z Statistic (biological > random) vs activity levels,
#for biological task ON, random taks ON
ggplot() +
geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +
labs(y = "BOLD Signal Level", x="Z Stat") +
geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste("Average over activation = ",on.off)), stat="summary",   fun.y = mean) +
scale_color_manual(values=c("#FFCCFF", "#9999CC", "#66CC99", "#3399CC", "Red", "Blue"))
# Chunk 7
###Looking at relationship between activity levels, between biological, random
##plot histogram of activity levels for different tasks, over ONLY active voxels
p1 <- ggplot(data=stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask > 0),
select = -c(1,2,3) )) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
temp <- stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask ==0 ),
select = -c(1,2,3) )
temp <- sample_frac(temp, size=.1, replace=FALSE)
p2 <- ggplot(data=temp) +
geom_histogram(aes(x=values), binwidth = 3) +
scale_x_continuous(limits = c(-100,100))
grid.arrange(p1,p2,ncol=2)
temp <- gather(subset(c1045.as.column.centered, subset = BrainMask != 0),
key = "TimePoint", value = "result", 4:ncol(c1045.as.column.centered))
temp <- sample_frac(temp, size=.1, replace=FALSE)
ggplot(data=temp) +
geom_boxplot(aes(x= ClusterMask == 0, y=result)) +
ylim(c(-100,100)) +
labs(x="Active Region", y="BOLD Signal Intensity")
##histogram of Z scores
#ggplot(data=sample) +
#  geom_histogram(aes(x=.5*log((1+ZStat)/(1-ZStat)))) +
#  labs(x="Fisher transform of Z Stat") +
#  facet_wrap(~on.off)
##boxplot of Z scores for on and off
#ggplot(data=sample) +
#  geom_boxplot(aes(x=on.off, y=ZStat))
# Chunk 8
c1045.as.column$corr.biological <- apply(subset(c1045.as.column,
select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")),
1, cor, paradigm$Biological)
temp <- sample_frac(subset(c1045.as.column, BrainMask != 0), size = .1, replace = FALSE)
ggplot(data = temp, aes(x=ZStat, y=.5*log((1+corr.biological)/(1-corr.biological)))) +
geom_point(aes(color=ClusterMask)) +
labs(y="Fisher transform of Correlation Coefficient")
# Chunk 9
temp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c("BrainMask", "ZStat", "ClusterMask", "corr.biological", "bio.rand.max.min.diff")))
stats.activities.bio <- apply(temp[,paradigm$Biological], 1,
function(x) {
c(max = max(x),
median = median(x),
mean = mean(x),
quantile90 = quantile(x,probs=.9),
quantile80 = quantile(x,probs=.8),
quantile70 = quantile(x,probs=.7))
})
