{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Capstone Project EDA\"\nauthor: \"Michael An\"\ndate: \"April 7, 2016\"\noutput:\n  html_document: default\n  pdf_document:\n    latex_engine: xelatex\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, warning = FALSE)\n\nsource(\"exploratory_script_load.R\")\n```\n\n##Histogram of time activity points for (L) biological motion time points, (M) random motion time points, (R) all time points\n```{r}\n\n#plot histograms of time activity points for different task, over all voxels\np1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0), \n                select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +\n geom_histogram(aes(x=values))\n\np2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0), \n                        select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +\n  geom_histogram(aes(x=values))\n\np3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0), \n                        select = ! (names(c1045.as.column) %in% c(\"BrainMask\", \"ZStat\", \"ClusterMask\")) )) +\n  geom_histogram(aes(x=values))\n\ngrid.arrange(p1,p2,p3,ncol=3)\n```\n\n\n\n##Same histograms as above, but ONLY only voxels deemed \"active\" in biological task, compared to random task\n```{r}\n#plot histogram of time activity for different tasks, over ONLY active voxels\np1 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0), \n                        select = c(FALSE,FALSE,FALSE,paradigm$Biological) )) +\n  geom_histogram(aes(x=values))\n\np2 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask >0 ), \n                        select = c(FALSE,FALSE,FALSE,paradigm$Random) )) +\n  geom_histogram(aes(x=values))\n\np3 <- ggplot(data=stack(subset(c1045.as.column, subset = BrainMask != 0 & ClusterMask > 0), \n                        select = ! (names(c1045.as.column) %in% c(\"BrainMask\", \"ZStat\", \"ClusterMask\")) )) +\n  geom_histogram(aes(x=values))\n\ngrid.arrange(p1,p2,p3,ncol=3)\n```\n\n##Scatterplot of BOLD Activity vs Z Statistic (for biological > random) over time points with biological task ON and OFF, and time points with random task ON and OFF\n```{r}\n#gather all time activitry points into one column, for all masked points.\n#introduce group factors for biological vs motion, and activation region vs. not activated\nresult <- subset(c1045.as.column, subset = BrainMask != 0) %>%\n  gather(key = \"Label\", value = \"Activity\", 4:ncol(c1045.as.column)) %>%\n  mutate(on.off = Label %in% names(c1045.as.column)[c(FALSE, FALSE, FALSE, paradigm$Biological)])\nresult$color.groups <- \"None\"\nresult$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- \"1Biological, Not Active\"\nresult$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- \"2Random, Not Active\"\nresult$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- \"3Biological, Activated\"\nresult$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- \"4Random, Activated\"\n\nresult$color.groups <- as.factor(result$color.groups)\n\n#get just a small sample (1%) of the activity data, otherwise too many voxels\nsampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)\n\n\n#scatterplot of Z Statistic (biological > random) vs activity levels,\n#for biological task ON, random taks ON\nggplot() +\n  geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +\n  labs(y = \"BOLD Signal Level\", x=\"Z Stat\") + \n  geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste(\"Average over activation = \",on.off)), stat=\"summary\",   fun.y = mean) +\n  scale_color_manual(values=c(\"#FFCCFF\", \"#9999CC\", \"#66CC99\", \"#3399CC\", \"Red\", \"Blue\"))\n```\n\n##Same plot as above, but with the BOLD signal at each voxel noramlized (means subtracted from each voxel's time plot)\n```{r}\n###repeat the above, but using CENTERED fMRI data (mean centered at 0)\n\n\nresult <- subset(c1045.as.column.centered, subset = BrainMask != 0) %>%\n  gather(key = \"Label\", value = \"Activity\", 4:ncol(c1045.as.column.centered)) %>%\n  mutate(on.off = Label %in% names(c1045.as.column.centered)[c(FALSE, FALSE, FALSE, paradigm$Biological)])\nresult$color.groups <- \"None\"\nresult$color.groups[result$ClusterMask == 0 & result$on.off == TRUE] <- \"1Biological, Not Active\"\nresult$color.groups[result$ClusterMask == 0 & result$on.off == FALSE] <- \"2Random, Not Active\"\nresult$color.groups[result$ClusterMask > 0 & result$on.off == TRUE] <- \"3Biological, Activated\"\nresult$color.groups[result$ClusterMask > 0 & result$on.off == FALSE] <- \"4Random, Activated\"\n\nresult$color.groups <- as.factor(result$color.groups)\n\n#get just a small sample (1%) of the activity data, otherwise too many voxels\nsampleres <- result %>% group_by(on.off) %>% sample_frac(size = .01, replace = FALSE)\n```\n\n###Looking at relationship between BOLD activity levels, between biological, random\n##Histograms ONLY over active voxels\n```{r}\n#scatterplot of Z Statistic (biological > random) vs activity levels,\n#for biological task ON, random taks ON\nggplot() +\n  geom_point(data = sampleres, aes(x=ZStat, y=Activity, color=color.groups)) +\n  labs(y = \"BOLD Signal Level\", x=\"Z Stat\") + \n  geom_line(data = sampleres, aes(x=floor(ZStat*10)/10,y=floor(Activity/5)*5, color = paste(\"Average over activation = \",on.off)), stat=\"summary\",   fun.y = mean) +\n  scale_color_manual(values=c(\"#FFCCFF\", \"#9999CC\", \"#66CC99\", \"#3399CC\", \"Red\", \"Blue\"))\n\n\n###Looking at relationship between activity levels, between biological, random\n##plot histogram of activity levels for different tasks, over ONLY active voxels\np1 <- ggplot(data=stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask > 0), \n                        select = -c(1,2,3) )) +\n  geom_histogram(aes(x=values), binwidth = 3) +\n  scale_x_continuous(limits = c(-100,100))\n\ntemp <- stack(subset(c1045.as.column.centered, subset = BrainMask != 0 & ClusterMask ==0 ), \n              select = -c(1,2,3) )\ntemp <- sample_frac(temp, size=.1, replace=FALSE)\n\n\np2 <- ggplot(data=temp) +\n  geom_histogram(aes(x=values), binwidth = 3) +\n  scale_x_continuous(limits = c(-100,100))\n\n\ngrid.arrange(p1,p2,ncol=2)\n\ntemp <- gather(subset(c1045.as.column.centered, subset = BrainMask != 0),\n               key = \"TimePoint\", value = \"result\", 4:ncol(c1045.as.column.centered))\ntemp <- sample_frac(temp, size=.1, replace=FALSE)\nggplot(data=temp) +\n  geom_boxplot(aes(x= ClusterMask == 0, y=result)) +\n  ylim(c(-100,100)) +\n  labs(x=\"Active Region\", y=\"BOLD Signal Intensity\")\n\n\n\n##histogram of Z scores\n#ggplot(data=sample) +\n#  geom_histogram(aes(x=.5*log((1+ZStat)/(1-ZStat)))) +\n#  labs(x=\"Fisher transform of Z Stat\") +\n#  facet_wrap(~on.off) \n\n##boxplot of Z scores for on and off\n#ggplot(data=sample) +\n#  geom_boxplot(aes(x=on.off, y=ZStat))\n\n\n```\n\n##Compute correlation coefficients between biological even paradigm, and time activity\n##signal for all voxels\n\n```{r}\nc1045.as.column$corr.biological <- apply(subset(c1045.as.column, \n                                                select = ! names(c1045.as.column) %in% c(\"BrainMask\", \"ZStat\", \"ClusterMask\", \"corr.biological\", \"bio.rand.max.min.diff\")),\n                                         1, cor, paradigm$Biological)\n\ntemp <- sample_frac(subset(c1045.as.column, BrainMask != 0), size = .1, replace = FALSE)\n\nggplot(data = temp, aes(x=ZStat, y=corr.biological)) +\n  geom_point(aes(color=ClusterMask)) +\n  labs(y=\"Correlation Coefficient\")\n\n```\n\n##Histogram of % change between (a statistic of) biological motion time activity points, and (a statistic of) random motion time activity points\n```{r}\n\ntemp <- as.matrix(subset(c1045.as.column.centered, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c(\"BrainMask\", \"ZStat\", \"ClusterMask\", \"corr.biological\", \"bio.rand.max.min.diff\")))\n\n#max.activities.bio <- apply(temp[,paradigm$Biological], 1, max)\n#median.activities.bio <- apply(temp[,paradigm$Biological], 1, median)\n#mean.activities.bio <- apply(temp[,paradigm$Biological], 1, mean)\n#quantile90.activities.bio <- apply(temp[,paradigm$Biological], 1, quantile, probs = #.9)\n#quantile80.activities.bio <- apply(temp[,paradigm$Biological], 1, quantile, probs = #.8)\n#quantile70.activities.bio <- apply(temp[,paradigm$Biological], 1, quantile, probs = #.7)\n\nstats.activities.bio <- apply(temp[,paradigm$Biological], 1, \n                              function(x) {c(max.activities = max(x),\n                                           median.activities = median(x),\n                                           mean.activities = mean(x),\n                                           quantile90.activities = quantile(x,probs = .9),\n                                           quantile80.activities = quantile(x, probs = .8),\n                                           quantile70.activities = quantile(x, probs = .7)\n                                           )}\n                              )\n\ntemp <- as.matrix(subset(c1045.as.column, subset = BrainMask != 0, select = ! names(c1045.as.column) %in% c(\"BrainMask\", \"ZStat\", \"ClusterMask\", \"corr.biological\", \"bio.rand.max.min.diff\")))\n\n#min.activities.rand <- apply(temp[,paradigm$Random], 1, min)\n#median.activities.rand <- apply(temp[,paradigm$Random], 1, median)\n#mean.activities.rand <- apply(temp[,paradigm$Random], 1, mean)\n#quantile90.activities.rand <- apply(temp[,paradigm$Random], 1, quantile, probs = .9)\n#quantile80.activities.rand <- apply(temp[,paradigm$Random], 1, quantile, probs = .8)\n#quantile70.activities.rand <- apply(temp[,paradigm$Random], 1, quantile, probs = .7)\n\nstats.activities.rand <- apply(temp[,paradigm$Random], 1, \n                              function(x) {c(max.activities = max(x),\n                                           median.activities = median(x),\n                                           mean.activities = mean(x),\n                                           quantile90.activities = quantile(x,probs = .9),\n                                           quantile80.activities = quantile(x, probs = .8),\n                                           quantile70.activities = quantile(x, probs = .7)\n                                           )}\n                              )\n\ntemp <- as.data.frame(matrix(0,nrow = nrow(c1045.as.column),ncol = 6))\ntemp[c1045.as.column$BrainMask != 0,] <-\n      t(stats.activities.bio - stats.activities.rand)\nnames(temp) <- c(\"bio.rand.max.min.diff\", \"bio.rand.median.diff\", \"bio.rand.mean.diff\",\n                 \"bio.rand.quantile90.diff\", \"bio.rand.quantile80.diff\",\n                 \"bio.rand.quantile70.diff\")\nc1045.as.column <- cbind(c1045.as.column, temp)\nrm(list = \"temp\")\n\n#c1045.as.column$bio.rand.max.min.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.max.min.diff[c1045.as.column$BrainMask != 0] <-  #max.activities.bio - min.activities.rand\n\n#c1045.as.column$bio.rand.median.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.median.diff[c1045.as.column$BrainMask != 0] <-  #median.activities.bio - median.activities.rand\n\n#c1045.as.column$bio.rand.mean.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.mean.diff[c1045.as.column$BrainMask != 0] <-  #mean.activities.bio - mean.activities.rand\n\n#c1045.as.column$bio.rand.quantile90.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.quantile90.diff[c1045.as.column$BrainMask != 0] <-  #quantile90.activities.bio - quantile90.activities.rand\n\n#c1045.as.column$bio.rand.quantile80.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.quantile80.diff[c1045.as.column$BrainMask != 0] <-  #quantile80.activities.bio - quantile80.activities.rand\n\n#c1045.as.column$bio.rand.quantile70.diff <- c(rep(0,nrow(c1045.as.column)))\n#c1045.as.column$bio.rand.quantile70.diff[c1045.as.column$BrainMask != 0] <-  #quantile70.activities.bio - quantile70.activities.rand\n\n#rm(list = c(max.activities.bio, min.activities.rand, \n#            median.activities.bio, median.activities.rand,\n#            mean.activities.bio, mean.activities.rand))\n\np1 <- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.max.min.diff)) +\n  geom_point(aes(color=ClusterMask))\n\np2 <- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.median.diff)) +\n  geom_point(aes(color=ClusterMask))\n\np3 <- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.mean.diff)) +\n  geom_point(aes(color=ClusterMask))\n\n\n\ngrid.arrange(p1,p2,p3,ncol = 3)\n\n\n\n\np1<- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.quantile90.diff)) +\n  geom_point(aes(color=ClusterMask))\np2<- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.quantile80.diff)) +\n  geom_point(aes(color=ClusterMask))\np3<- ggplot(data = subset(c1045.as.column, BrainMask != 0), \n       aes(x=ZStat, y=bio.rand.quantile70.diff)) +\n  geom_point(aes(color=ClusterMask))\n\ngrid.arrange(p1, p2,p3,ncol = 3)\n\nc1045.as.column$bio.rand.max.min.diff <- NULL\nc1045.as.column$bio.rand.median.diff <- NULL\nc1045.as.column$bio.rand.mean.diff <- NULL\n\n```\n\n",
    "created" : 1460051910094.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2861574333",
    "id" : "77218311",
    "lastKnownWriteTime" : 1460357232,
    "last_content_update" : 1460360424514,
    "path" : "~/Documents/Foundations_Course/Capstone/exploratory_script_EDA.Rmd",
    "project_path" : "exploratory_script_EDA.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}